{"version":3,"sources":["Machine.ts"],"names":[],"mappings":"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","file":"","sourceRoot":"..\\..\\..\\..\\..\\assets\\scripts\\slots","sourcesContent":["import Aux from '../SlotEnum';\r\n\r\nconst { ccclass, property } = cc._decorator;\r\n\r\n@ccclass\r\nexport default class Machine extends cc.Component {\r\n  @property(cc.Node)\r\n  public button: cc.Node = null;\r\n\r\n  @property(cc.Prefab)\r\n  public _reelPrefab = null;\r\n\r\n  @property(cc.Node)\r\n  gameManager = null;\r\n\r\n  @property({ type: cc.Prefab })\r\n  get reelPrefab(): cc.Prefab {\r\n    return this._reelPrefab;\r\n  }\r\n\r\n  set reelPrefab(newPrefab: cc.Prefab) {\r\n    this._reelPrefab = newPrefab;\r\n    this.node.removeAllChildren();\r\n\r\n    if (newPrefab !== null) {\r\n      this.createMachine();\r\n    }\r\n  }\r\n\r\n  @property({ type: cc.Integer })\r\n  public _numberOfReels = 3;\r\n\r\n  @property({ type: cc.Integer, range: [3, 6], slide: true })\r\n  get numberOfReels(): number {\r\n    return this._numberOfReels;\r\n  }\r\n\r\n  set numberOfReels(newNumber: number) {\r\n    this._numberOfReels = newNumber;\r\n\r\n    if (this.reelPrefab !== null) {\r\n      this.createMachine();\r\n    }\r\n  }\r\n\r\n  private reels = [];\r\n\r\n  public spinning = false;\r\n\r\n  private gm = null\r\n\r\n  createMachine(): void {\r\n    this.gm = this.gameManager.getComponent('GameManager')\r\n    this.node.destroyAllChildren();\r\n    this.reels = [];\r\n\r\n    let newReel: cc.Node;\r\n    for (let i = 0; i < this.numberOfReels; i += 1) {\r\n      newReel = cc.instantiate(this.reelPrefab);\r\n      this.node.addChild(newReel);\r\n      this.reels[i] = newReel;\r\n\r\n      const reelScript = newReel.getComponent('Reel');\r\n      reelScript.shuffle();\r\n      reelScript.reelAnchor.getComponent(cc.Layout).enabled = false;\r\n    }\r\n\r\n    this.node.getComponent(cc.Widget).updateAlignment();\r\n  }\r\n\r\n  spin(): void {\r\n    this.spinning = true;\r\n    this.button.getChildByName('Label').getComponent(cc.Label).string = 'STOP';\r\n\r\n    for (let i = 0; i < this.numberOfReels; i += 1) {\r\n      const theReel = this.reels[i].getComponent('Reel');\r\n\r\n      if (i % 2) {\r\n        theReel.spinDirection = Aux.Direction.Down;\r\n      } else {\r\n        theReel.spinDirection = Aux.Direction.Up;\r\n      }\r\n\r\n      theReel.doSpin(0.03 * i);\r\n    }\r\n  }\r\n\r\n  lock(): void {\r\n    this.button.getComponent(cc.Button).interactable = false;\r\n  }\r\n\r\n  stop(result: Array<Array<number>> = null): void {\r\n    setTimeout(() => {\r\n      this.spinning = false;\r\n      this.button.getComponent(cc.Button).interactable = true;\r\n      this.button.getChildByName('Label').getComponent(cc.Label).string = 'SPIN';\r\n    }, 2500);\r\n\r\n    const rngMod = Math.random() / 2;\r\n    for (let i = 0; i < this.numberOfReels; i += 1) {\r\n      const spinDelay = i < 2 + rngMod ? i / 4 : rngMod * (i - 2) + i / 4;\r\n      const theReel = this.reels[i].getComponent('Reel');\r\n\r\n      setTimeout(() => {\r\n        theReel.readyStop(result[i]);\r\n        \r\n\r\n        // if(this.gm.animLine0.active == true || this.gm.animline1.active == true || this.gm.animLine2.active == true){\r\n        //   // Algum AnimLine está ativo, por tanto, não precisa ativar mais\r\n        // }\r\n        // else{\r\n\r\n\r\n\r\n        // }\r\n\r\n        if (this.gm.luck > 93){\r\n\r\n          // 7% of the time all lines should show equal tiles.\r\n          this.gm.animLine0.active = true;\r\n          this.gm.animLine1.active = true;\r\n          this.gm.animLine2.active = true;\r\n\r\n        }\r\n        else if (this.gm.luck > 83 && this.gm.luck <= 93){\r\n\r\n          // 10% of the time it should display two lines of equal tiles.\r\n          this.gm.animLine1.active = true;\r\n          this.gm.animLine2.active = true;\r\n\r\n        }\r\n        else if (this.gm.luck > 50 && this.gm.luck <= 83){\r\n\r\n          // 33% of the time it should display a single line of equal tiles.\r\n          this.gm.animLine1.active = true;\r\n\r\n        }\r\n        else if (this.gm.luck <= 50){\r\n\r\n          // 50% of the time it should return this random configuration of tiles.\r\n\r\n        }\r\n\r\n\r\n\r\n      }, spinDelay * 1000);\r\n    }\r\n  }\r\n}\r\n"]}