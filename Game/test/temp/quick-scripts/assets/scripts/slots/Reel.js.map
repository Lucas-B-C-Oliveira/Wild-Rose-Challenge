{"version":3,"sources":["Reel.ts"],"names":[],"mappings":"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","file":"","sourceRoot":"..\\..\\..\\..\\..\\assets\\scripts\\slots","sourcesContent":["import Aux from '../SlotEnum';\r\n\r\nconst { ccclass, property } = cc._decorator;\r\n\r\n@ccclass\r\nexport default class Reel extends cc.Component {\r\n  @property({ type: cc.Node })\r\n  public reelAnchor = null;\r\n\r\n  @property({ type: cc.Enum(Aux.Direction) })\r\n  public spinDirection = Aux.Direction.Down;\r\n\r\n  @property({ type: [cc.Node], visible: false })\r\n  private tiles = [];\r\n\r\n  @property({ type: cc.Prefab })\r\n  public _tilePrefab = null;\r\n\r\n  @property({ type: cc.Prefab })\r\n  get tilePrefab(): cc.Prefab {\r\n    return this._tilePrefab;\r\n  }\r\n\r\n  set tilePrefab(newPrefab: cc.Prefab) {\r\n    this._tilePrefab = newPrefab;\r\n    this.reelAnchor.removeAllChildren();\r\n    this.tiles = [];\r\n\r\n    if (newPrefab !== null) {\r\n      this.createReel();\r\n      this.shuffle();\r\n    }\r\n  }\r\n\r\n  private result: Array<number> = [];\r\n\r\n  public stopSpinning = false;\r\n\r\n  createReel(): void {\r\n    let newTile: cc.Node;\r\n    for (let i = 0; i < 5; i += 1) {\r\n      newTile = cc.instantiate(this.tilePrefab);\r\n      this.reelAnchor.addChild(newTile);\r\n      this.tiles[i] = newTile;\r\n    }\r\n  }\r\n\r\n  shuffle(): void {\r\n    for (let i = 0; i < this.tiles.length; i += 1) {\r\n      this.tiles[i].getComponent('Tile').setRandom();\r\n    }\r\n  }\r\n\r\n  readyStop(newResult: Array<number>): void {\r\n    const check = this.spinDirection === Aux.Direction.Down || newResult == null;\r\n    this.result = check ? newResult : newResult.reverse();\r\n    this.stopSpinning = true;\r\n  }\r\n\r\n  changeCallback(element: cc.Node = null): void {\r\n    const el = element;\r\n    const dirModifier = this.spinDirection === Aux.Direction.Down ? -1 : 1;\r\n    if (el.position.y * dirModifier > 288) {\r\n      el.position = cc.v2(0, -288 * dirModifier);\r\n\r\n      let pop = null;\r\n      if (this.result != null && this.result.length > 0) {\r\n        pop = this.result.pop();\r\n      }\r\n\r\n      if (pop != null && pop >= 0) {\r\n        el.getComponent('Tile').setTile(pop);\r\n      } else {\r\n        el.getComponent('Tile').setRandom();\r\n      }\r\n    }\r\n  }\r\n\r\n  checkEndCallback(element: cc.Node = null): void {\r\n    const el = element;\r\n    if (this.stopSpinning) {\r\n      this.getComponent(cc.AudioSource).play();\r\n      this.doStop(el);\r\n    } else {\r\n      this.doSpinning(el);\r\n    }\r\n  }\r\n\r\n  doSpin(windUp: number): void {\r\n    this.stopSpinning = false;\r\n\r\n    this.reelAnchor.children.forEach(element => {\r\n      const dirModifier = this.spinDirection === Aux.Direction.Down ? -1 : 1;\r\n\r\n      const delay = cc.tween(element).delay(windUp);\r\n      const start = cc.tween(element).by(0.25, { position: cc.v2(0, 144 * dirModifier) }, { easing: 'backIn' });\r\n      const doChange = cc.tween().call(() => this.changeCallback(element));\r\n      const callSpinning = cc.tween(element).call(() => this.doSpinning(element, 5));\r\n\r\n      delay\r\n        .then(start)\r\n        .then(doChange)\r\n        .then(callSpinning)\r\n        .start();\r\n    });\r\n  }\r\n\r\n  doSpinning(element: cc.Node = null, times = 1): void {\r\n    const dirModifier = this.spinDirection === Aux.Direction.Down ? -1 : 1;\r\n\r\n    const move = cc.tween().by(0.04, { position: cc.v2(0, 144 * dirModifier) });\r\n    const doChange = cc.tween().call(() => this.changeCallback(element));\r\n    const repeat = cc.tween(element).repeat(times, move.then(doChange));\r\n    const checkEnd = cc.tween().call(() => this.checkEndCallback(element));\r\n\r\n    repeat.then(checkEnd).start();\r\n  }\r\n\r\n  doStop(element: cc.Node = null): void {\r\n    const dirModifier = this.spinDirection === Aux.Direction.Down ? -1 : 1;\r\n\r\n    const move = cc.tween(element).by(0.04, { position: cc.v2(0, 144 * dirModifier) });\r\n    const doChange = cc.tween().call(() => this.changeCallback(element));\r\n    const end = cc.tween().by(0.2, { position: cc.v2(0, 144 * dirModifier) }, { easing: 'bounceOut' });\r\n\r\n    move\r\n      .then(doChange)\r\n      .then(move)\r\n      .then(doChange)\r\n      .then(end)\r\n      .then(doChange)\r\n      .start();\r\n  }\r\n}\r\n"]}